<!--Recommended by dpsk-->

<!--Option 2: Dynamic Form with Additional Fields (Best User Experience)
Here's the complete implementation:

1. Update the HTML Form (in your single file):
Replace the barangay section in the form with this:-->

<div class="form-group">
    <label for="barangay">Barangay:</label>
    <select id="barangay" name="barangay" required onchange="toggleCityInput()">
        <option value="">Select Barangay</option>
        <option value="Alasa">Alasa</option>
        <option value="Baliti">Baliti</option>
        <option value="Bulaon">Bulaon</option>
        <option value="Calulut">Calulut</option>
        <option value="Del Carmen">Del Carmen</option>
        <option value="Del Pilar">Del Pilar</option>
        <option value="Del Rosario">Del Rosario</option>
        <option value="Dela Paz Norte">Dela Paz Norte</option>
        <option value="Dela Paz Sur">Dela Paz Sur</option>
        <option value="Dolores">Dolores</option>
        <option value="Juliana">Juliana</option>
        <option value="Lara">Lara</option>
        <option value="Lourdes">Lourdes</option>
        <option value="Magliman">Magliman</option>
        <option value="Maimpis">Maimpis</option>
        <option value="Malino">Malino</option>
        <option value="Malpitic">Malpitic</option>
        <option value="Pandaras">Pandaras</option>
        <option value="Panipuan">Panipuan</option>
        <option value="Pulung Bulu">Pulung Bulu</option>
        <option value="Quebiauan">Quebiauan</option>
        <option value="Saguin">Saguin</option>
        <option value="San Agustin">San Agustin</option>
        <option value="San Felipe">San Felipe</option>
        <option value="San Isidro">San Isidro</option>
        <option value="San Jose">San Jose</option>
        <option value="San Juan">San Juan</option>
        <option value="San Nicolas">San Nicolas</option>
        <option value="San Pedro">San Pedro</option>
        <option value="Santa Lucia">Santa Lucia</option>
        <option value="Santa Teresita">Santa Teresita</option>
        <option value="Santo Niño">Santo Niño</option>
        <option value="Santo Rosario">Santo Rosario</option>
        <option value="Sindalan">Sindalan</option>
        <option value="Telebastagan">Telebastagan</option>
        <option value="OTHER">Other (Outside SF Pampanga)</option>
    </select>
</div>

<!-- Additional fields for outside clients -->
<div id="outside-fields" style="display: none;">
    <div class="form-group">
        <label for="custom-barangay">Barangay (Outside SF):</label>
        <input type="text" id="custom-barangay" name="custom-barangay" placeholder="Enter your barangay">
    </div>
    <div class="form-group">
        <label for="city">City/Municipality:</label>
        <input type="text" id="city" name="city" placeholder="Enter your city/municipality">
    </div>
    <div class="form-group">
        <label for="province">Province:</label>
        <input type="text" id="province" name="province" placeholder="Enter your province">
    </div>
</div>


<!--2. Add CSS Styles (add to your style section):-->

<style>
    /* Outside location styles */
.outside-location {
    background: #fff3cd !important;
    border-left: 4px solid #ffc107 !important;
}

.outside-badge {
    background: #ffc107;
    color: #856404;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.8em;
    font-weight: bold;
    margin-left: 5px;
}
</style>

<!--3. Add JavaScript Functions (add to your script section):-->

<script>
    // Toggle additional fields for outside clients
function toggleCityInput() {
    const barangaySelect = document.getElementById('barangay');
    const outsideFields = document.getElementById('outside-fields');
    const customBarangay = document.getElementById('custom-barangay');
    const city = document.getElementById('city');
    const province = document.getElementById('province');
    
    if (barangaySelect.value === 'OTHER') {
        outsideFields.style.display = 'block';
        // Make outside fields required
        customBarangay.required = true;
        city.required = true;
        province.required = true;
    } else {
        outsideFields.style.display = 'none';
        // Remove required from outside fields
        customBarangay.required = false;
        city.required = false;
        province.required = false;
        // Clear outside fields
        customBarangay.value = '';
        city.value = '';
        province.value = '';
    }
    // Re-validate form
    setupFormValidation();
}

// Update the form validation function
function setupFormValidation() {
    const form = document.getElementById('customer-form');
    const printBtn = document.getElementById('print-btn');
    const inputs = form.querySelectorAll('input, select');
    
    function checkFormValidity() {
        let allValid = true;
        inputs.forEach(input => {
            // Only check visible and required fields
            if (input.offsetParent !== null && input.required && !input.checkValidity()) {
                allValid = false;
            }
        });
        printBtn.disabled = !allValid;
    }
    
    inputs.forEach(input => {
        input.addEventListener('input', checkFormValidity);
        input.addEventListener('change', checkFormValidity);
    });
    
    checkFormValidity();
}

// Update the generateTicket function to handle outside clients
function generateTicket() {
    const formData = {
        name: document.getElementById('name').value,
        address: document.getElementById('address').value,
        barangay: document.getElementById('barangay').value
    };
    
    // Handle outside clients
    let clientLocation = formData.barangay;
    let isOutsideClient = false;
    
    if (formData.barangay === 'OTHER') {
        const customBarangay = document.getElementById('custom-barangay').value;
        const city = document.getElementById('city').value;
        const province = document.getElementById('province').value;
        clientLocation = `${customBarangay}, ${city}, ${province}`;
        isOutsideClient = true;
    }
    
    const prefix = currentService === 'Mayors Working Permit' ? 'MWP' : 'MCL';
    const typeCode = currentSubService === 'Newly Hired' ? 'N' : 'R';
    const priorityCode = currentClientType === 'Senior/PWD' ? 'P' : 'R';
    const number = queueNumbers[currentService][currentSubService][currentClientType];
    
    const queueNumber = `${prefix}${typeCode}${priorityCode}${number.toString().padStart(3, '0')}`;
    
    queueNumbers[currentService][currentSubService][currentClientType]++;
    
    const ticketData = {
        queueNumber: queueNumber,
        service: currentService,
        subService: currentSubService,
        clientType: currentClientType,
        name: formData.name,
        barangay: clientLocation,
        isOutsideClient: isOutsideClient
    };

    addToQueue(ticketData);
    
    const ticketElement = document.getElementById('printed-ticket');
    const queueNumberElement = document.getElementById('queue-number');
    
    if (currentClientType === 'Senior/PWD') {
        ticketElement.classList.add('priority-ticket');
        queueNumberElement.classList.add('priority-number');
    } else {
        ticketElement.classList.remove('priority-ticket');
        queueNumberElement.classList.remove('priority-number');
    }
    
    // Add outside client styling
    if (isOutsideClient) {
        ticketElement.classList.add('outside-location');
    }
    
    document.getElementById('queue-number').textContent = queueNumber;
    document.getElementById('ticket-service').textContent = currentService;
    document.getElementById('ticket-type').textContent = currentSubService;
    
    const clientTypeElement = document.createElement('p');
    clientTypeElement.innerHTML = `<strong>Client Type:</strong> <span id="ticket-client-type">${currentClientType}</span>`;
    if (currentClientType === 'Senior/PWD') {
        clientTypeElement.innerHTML = `<strong>Client Type:</strong> <span class="priority-badge">${currentClientType}</span>`;
    }
    
    const ticketDetails = document.querySelector('.ticket-details');
    const existingClientType = document.getElementById('ticket-client-type');
    if (existingClientType) {
        existingClientType.parentElement.remove();
    }
    const serviceElement = document.querySelector('#ticket-service').parentElement;
    serviceElement.parentNode.insertBefore(clientTypeElement, serviceElement.nextSibling);
    
    document.getElementById('ticket-name').textContent = formData.name;
    document.getElementById('ticket-barangay').textContent = clientLocation;
    document.getElementById('ticket-date').textContent = new Date().toLocaleDateString();
    
    // Add outside client badge if needed
    if (isOutsideClient) {
        const locationElement = document.querySelector('#ticket-barangay').parentElement;
        locationElement.innerHTML += ` <span class="outside-badge">Outside</span>`;
    }
    
    showPage('ticket-page');
    
    setTimeout(() => {
        window.print();
    }, 500);
    
    document.getElementById('customer-form').reset();
    // Hide outside fields after reset
    document.getElementById('outside-fields').style.display = 'none';
    localStorage.setItem('queueNumbers', JSON.stringify(queueNumbers));
}

// Update the addToQueue function
function addToQueue(ticketData) {
    const queueItem = {
        number: ticketData.queueNumber,
        service: ticketData.service,
        type: ticketData.subService,
        clientType: ticketData.clientType,
        name: ticketData.name,
        barangay: ticketData.barangay,
        timestamp: new Date().toISOString(),
        called: false,
        completed: false,
        noshow: false,
        isPriority: ticketData.clientType === 'Senior/PWD',
        isOutsideClient: ticketData.isOutsideClient || false
    };

    currentQueue.push(queueItem);
    localStorage.setItem('currentQueue', JSON.stringify(currentQueue));
    localStorage.setItem('queueUpdated', Date.now().toString());
    
    updateClientDisplay();
    updateEmployeeDisplay();
}

// Update the employee display to show outside clients
function addEmployeeQueueItem(item, queueList, isPriority) {
    const queueItem = document.createElement('div');
    const isServing = currentQueue.indexOf(item) === servingIndex;
    
    let queueItemClass = `employee-queue-item ${isServing ? 'employee-status-serving' : 
        item.called ? 'employee-status-called' : 'employee-status-waiting'}`;
    
    if (isPriority) {
        queueItemClass += ' priority-queue';
    }
    if (item.isOutsideClient) {
        queueItemClass += ' outside-location';
    }
    
    queueItem.className = queueItemClass;
    
    queueItem.innerHTML = `
        <div>
            <div class="employee-queue-number ${isPriority ? 'priority-number' : ''}">${item.number}</div>
            <div class="employee-queue-service">${item.service} - ${item.type}</div>
            ${isPriority ? '<div style="color: #e67e22; font-size: 0.9em;">👵 Senior/PWD</div>' : ''}
            ${item.isOutsideClient ? '<div style="color: #856404; font-size: 0.9em;">📍 Outside SF Pampanga</div>' : ''}
        </div>
        <div>${item.name}</div>
    `;
    
    queueList.appendChild(queueItem);
}
</script>